<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LCTL Dashboard - Time-Travel Debugging</title>
    <link rel="stylesheet" href="/static/styles.css">
</head>
<body>
    <div class="app">
        <!-- Header -->
        <header class="header">
            <div class="header-left">
                <h1 class="logo">LCTL</h1>
                <span class="tagline">Time-Travel Debugging for Multi-Agent Workflows</span>
            </div>
            <div class="header-right">
                <select id="chain-selector" class="chain-selector">
                    <option value="">Select a chain...</option>
                </select>
                <button id="refresh-btn" class="btn btn-secondary" title="Refresh chains">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M23 4v6h-6M1 20v-6h6"/>
                        <path d="M3.51 9a9 9 0 0114.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0020.49 15"/>
                    </svg>
                </button>
                <div class="header-divider"></div>
                <button id="compare-btn" class="btn btn-secondary" title="Compare chains" disabled>
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M16 3h5v5M8 3H3v5M8 21H3v-5M16 21h5v-5M12 12m-3 0a3 3 0 1 0 6 0a3 3 0 1 0 -6 0"/>
                    </svg>
                    Compare
                </button>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- No chain selected state -->
            <div id="empty-state" class="empty-state">
                <div class="empty-icon">
                    <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                        <path d="M13 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V9z"/>
                        <path d="M13 2v7h7"/>
                    </svg>
                </div>
                <h2>No Chain Selected</h2>
                <p>Select a .lctl.json file from the dropdown above to visualize the agent workflow.</p>
                <p class="working-dir">Working directory: <code id="working-dir-path">-</code></p>
            </div>

            <!-- Dashboard content (hidden until chain is loaded) -->
            <div id="dashboard" class="dashboard hidden">
                <!-- Tab navigation -->
                <div class="tabs">
                    <button class="tab active" data-tab="timeline-tab">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <polyline points="12,6 12,12 16,14"/>
                        </svg>
                        Timeline
                    </button>
                    <button class="tab" data-tab="metrics-tab">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M18 20V10M12 20V4M6 20v-6"/>
                        </svg>
                        Metrics
                    </button>
                    <button class="tab" data-tab="evaluation-tab">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M22 11.08V12a10 10 0 11-5.93-9.14"/>
                            <polyline points="22,4 12,14.01 9,11.01"/>
                        </svg>
                        Evaluation
                    </button>
                </div>

                <!-- Timeline Tab Content -->
                <div id="timeline-tab" class="tab-content active">
                <!-- Time-travel slider -->
                <div class="time-travel-panel">
                    <div class="time-travel-header">
                        <h3>Time-Travel Debugger</h3>
                        <div class="time-travel-controls">
                            <button id="play-btn" class="btn btn-icon" title="Play/Pause">
                                <svg id="play-icon" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                    <polygon points="5,3 19,12 5,21"/>
                                </svg>
                                <svg id="pause-icon" class="hidden" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                    <rect x="6" y="4" width="4" height="16"/>
                                    <rect x="14" y="4" width="4" height="16"/>
                                </svg>
                            </button>
                            <button id="step-back-btn" class="btn btn-icon" title="Step Back">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polygon points="11,19 2,12 11,5"/>
                                    <line x1="22" y1="12" x2="11" y2="12"/>
                                </svg>
                            </button>
                            <button id="step-forward-btn" class="btn btn-icon" title="Step Forward">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polygon points="13,19 22,12 13,5"/>
                                    <line x1="2" y1="12" x2="13" y2="12"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                    <div class="slider-container">
                        <input type="range" id="time-slider" class="time-slider" min="1" max="100" value="100">
                        <div class="slider-labels">
                            <span id="current-seq">Seq: 1</span>
                            <span id="max-seq">Max: 100</span>
                        </div>
                    </div>
                </div>

                <!-- Stats bar -->
                <div class="stats-bar">
                    <div class="stat">
                        <span class="stat-label">Events</span>
                        <span id="stat-events" class="stat-value">0</span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">Agents</span>
                        <span id="stat-agents" class="stat-value">0</span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">Facts</span>
                        <span id="stat-facts" class="stat-value">0</span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">Duration</span>
                        <span id="stat-duration" class="stat-value">0s</span>
                    </div>
                    <div class="stat">
                        <span class="stat-label">Tokens</span>
                        <span id="stat-tokens" class="stat-value">0</span>
                    </div>
                    <div class="stat stat-error">
                        <span class="stat-label">Errors</span>
                        <span id="stat-errors" class="stat-value">0</span>
                    </div>
                </div>

                <!-- Main panels -->
                <div class="panels">
                    <!-- Left panel: Timeline -->
                    <div class="panel panel-timeline">
                        <div class="panel-header">
                            <h3>Event Timeline</h3>
                            <div class="filter-controls">
                                <select id="event-filter" class="filter-select">
                                    <option value="all">All Events</option>
                                    <option value="step_start">Step Start</option>
                                    <option value="step_end">Step End</option>
                                    <option value="fact_added">Fact Added</option>
                                    <option value="fact_modified">Fact Modified</option>
                                    <option value="tool_call">Tool Calls</option>
                                    <option value="error">Errors</option>
                                    <option value="checkpoint">Checkpoints</option>
                                </select>
                            </div>
                        </div>
                        <div id="timeline" class="timeline"></div>
                    </div>

                    <!-- Center panel: Swim lanes -->
                    <div class="panel panel-swimlanes">
                        <div class="panel-header">
                            <h3>Agent Swim Lanes</h3>
                        </div>
                        <div id="swimlanes" class="swimlanes"></div>
                    </div>

                    <!-- Right panel: Fact registry -->
                    <div class="panel panel-facts">
                        <div class="panel-header">
                            <h3>Fact Registry</h3>
                        </div>
                        <div id="fact-registry" class="fact-registry"></div>
                    </div>
                </div>

                <!-- Bottom panel: Details -->
                <div class="panel panel-details">
                    <div class="panel-header">
                        <h3>Event Details</h3>
                        <span id="selected-event-label" class="selected-label">Select an event to view details</span>
                    </div>
                    <div id="event-details" class="event-details">
                        <div class="no-selection">Click on any event in the timeline or swim lanes to view details</div>
                    </div>
                </div>

                <!-- Bottleneck panel -->
                <div class="panel panel-bottlenecks">
                    <div class="panel-header">
                        <h3>Performance Bottlenecks</h3>
                    </div>
                    <div id="bottlenecks" class="bottlenecks"></div>
                </div>
                </div><!-- End Timeline Tab -->

                <!-- Metrics Tab Content -->
                <div id="metrics-tab" class="tab-content">
                    <div class="metrics-dashboard">
                        <!-- Latency Chart -->
                        <div class="panel panel-chart">
                            <div class="panel-header">
                                <h3>Agent Latency Distribution</h3>
                            </div>
                            <div class="chart-container">
                                <canvas id="latency-chart"></canvas>
                            </div>
                        </div>

                        <!-- Token Usage Chart -->
                        <div class="panel panel-chart">
                            <div class="panel-header">
                                <h3>Token Usage</h3>
                            </div>
                            <div class="chart-container">
                                <canvas id="token-chart"></canvas>
                            </div>
                        </div>

                        <!-- Agent Metrics Table -->
                        <div class="panel panel-wide">
                            <div class="panel-header">
                                <h3>Agent Metrics Breakdown</h3>
                            </div>
                            <div id="agent-metrics-table" class="metrics-table-container"></div>
                        </div>

                        <!-- Error Timeline -->
                        <div class="panel panel-wide">
                            <div class="panel-header">
                                <h3>Error Timeline</h3>
                            </div>
                            <div id="error-timeline" class="error-timeline-container"></div>
                        </div>
                    </div>
                </div><!-- End Metrics Tab -->

                <!-- Evaluation Tab Content -->
                <div id="evaluation-tab" class="tab-content">
                    <div class="evaluation-dashboard">
                        <!-- Score Cards -->
                        <div class="score-cards">
                            <div class="score-card overall">
                                <div class="score-label">Overall Score</div>
                                <div id="overall-score" class="score-value">--</div>
                                <div class="score-ring">
                                    <svg viewBox="0 0 36 36">
                                        <path class="score-ring-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"/>
                                        <path id="overall-ring" class="score-ring-fill" stroke-dasharray="0, 100" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"/>
                                    </svg>
                                </div>
                            </div>
                            <div class="score-card performance">
                                <div class="score-label">Performance</div>
                                <div id="perf-score" class="score-value">--</div>
                                <div class="score-bar">
                                    <div id="perf-bar" class="score-bar-fill"></div>
                                </div>
                            </div>
                            <div class="score-card reliability">
                                <div class="score-label">Reliability</div>
                                <div id="reliability-score" class="score-value">--</div>
                                <div class="score-bar">
                                    <div id="reliability-bar" class="score-bar-fill"></div>
                                </div>
                            </div>
                            <div class="score-card quality">
                                <div class="score-label">Quality</div>
                                <div id="quality-score" class="score-value">--</div>
                                <div class="score-bar">
                                    <div id="quality-bar" class="score-bar-fill"></div>
                                </div>
                            </div>
                        </div>

                        <!-- Issues and Warnings -->
                        <div class="panel panel-issues">
                            <div class="panel-header">
                                <h3>Issues & Warnings</h3>
                            </div>
                            <div id="issues-list" class="issues-container"></div>
                        </div>

                        <!-- Fact Confidence Heatmap -->
                        <div class="panel panel-heatmap">
                            <div class="panel-header">
                                <h3>Fact Confidence Heatmap</h3>
                            </div>
                            <div id="confidence-heatmap" class="heatmap-container"></div>
                        </div>

                        <!-- Evaluation Metrics Summary -->
                        <div class="panel panel-eval-summary">
                            <div class="panel-header">
                                <h3>Evaluation Summary</h3>
                            </div>
                            <div id="eval-summary" class="eval-summary-container"></div>
                        </div>
                    </div>
                </div><!-- End Evaluation Tab -->
            </div>
        </main>

        <!-- Comparison Modal -->
        <div id="compare-modal" class="modal hidden">
            <div class="modal-backdrop"></div>
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Compare Chains</h2>
                    <button id="close-modal" class="btn btn-icon">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="compare-selectors">
                        <div class="compare-select">
                            <label>Chain 1</label>
                            <select id="compare-chain1" class="chain-selector">
                                <option value="">Select first chain...</option>
                            </select>
                        </div>
                        <div class="compare-vs">VS</div>
                        <div class="compare-select">
                            <label>Chain 2</label>
                            <select id="compare-chain2" class="chain-selector">
                                <option value="">Select second chain...</option>
                            </select>
                        </div>
                    </div>
                    <button id="run-compare" class="btn btn-primary" disabled>Compare Chains</button>

                    <!-- Comparison Results -->
                    <div id="compare-results" class="compare-results hidden">
                        <div class="compare-summary">
                            <div class="compare-chain-summary" id="chain1-summary"></div>
                            <div class="compare-chain-summary" id="chain2-summary"></div>
                        </div>
                        <div class="compare-diffs">
                            <h4>Divergence Analysis</h4>
                            <div id="divergence-info" class="divergence-info"></div>
                            <div id="diff-list" class="diff-list"></div>
                        </div>
                        <div class="compare-facts">
                            <h4>Fact Comparison</h4>
                            <div id="fact-diff" class="fact-diff"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Toast notifications -->
        <div id="toast-container" class="toast-container"></div>
    </div>

    <script src="/static/app.js"></script>
</body>
</html>
